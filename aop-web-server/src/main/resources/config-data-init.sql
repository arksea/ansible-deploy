INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (1, b'1', '系统信息增、删、改：用户，群组，主机', '系统管理员');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (2, b'1', '系统信息查询：用户、群组、主机', '系统信息查询');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (3, b'1', '应用部署', '应用部署');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (4, b'1', '主机与端口管理', '主机管理');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (5, b'1', '添加应用类型，编辑应用操作脚本', '操作管理');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (6, b'1', '查看操作脚本', '操作查询');
INSERT INTO `sys_roles` (`id`, `available`, `description`, `role`) VALUES (7, b'1', '应用增、删、改', '应用管理');
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (1, b'1', '组信息管理', '组管理:修改', 902);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (2, b'1', '组信息查询', '组管理:查询', 901);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (3, b'1', '用户信息管理', '用户管理:修改', 902);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (4, b'1', '用户信息查询', '用户管理:查询', 901);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (5, b'1', '应用管理', '应用:修改', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (6, b'1', '执行应用的操作脚本', '应用:操作', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (7, b'1', '应用信息查询', '应用:查询', 901);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (8, b'1', '端口管理', '端口管理:修改', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (9, b'1', '端口查询', '端口管理:查询', 901);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (10, b'1', '增删改操作信息', '操作管理:修改', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (11, b'1', '查询操作脚本', '操作管理:查询', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (12, b'1', '主机管理', '主机管理:修改', NULL);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (13, b'1', '主机查询', '主机管理:查询', 901);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (901, b'1', '查询系统信息', '系统:查询', 902);
INSERT INTO `sys_permissions` (`id`, `available`, `description`, `permission`, `pid`) VALUES (902, b'1', '增删改系统信息', '系统:管理', NULL);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (1, 902);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (2, 7);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (2, 901);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (3, 6);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (3, 7);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (4, 8);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (4, 9);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (4, 12);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (4, 13);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (5, 10);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (5, 11);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (6, 11);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (7, 5);
INSERT INTO `sys_roles_permissions` (`role_id`, `permission_id`) VALUES (7, 7);
INSERT INTO `dp2_app_type` (`id`, `description`, `name`) VALUES (1, 'Java Web应用，容器为Tomcat8.0.3', 'Tomcat');
INSERT INTO `dp2_app_type` (`id`, `description`, `name`) VALUES (2, 'Java应用，不依赖于容器，直接使用java -jar方式启动', 'JavaServer');
INSERT INTO `dp2_app_type` (`id`, `description`, `name`) VALUES (3, '用Shell脚本启动的应用: 启动(startup.sh)，停止(shutdown.sh)', 'Command');
INSERT INTO `dp2_port_type` (`id`, `all_count`, `description`, `name`, `rest_count`) VALUES (1, 0, 'Web站点或RestAPI接口', 'HTTP', 0);
INSERT INTO `dp2_port_type` (`id`, `all_count`, `description`, `name`, `rest_count`) VALUES (2, 0, '通用端口', '通用', 0);
INSERT INTO `dp2_port_type` (`id`, `all_count`, `description`, `name`, `rest_count`) VALUES (3, 0, '应用服务端口', '应用', 0);
INSERT INTO `dp2_port_type` (`id`, `all_count`, `description`, `name`, `rest_count`) VALUES (4, 0, '旧系统已用端口', '旧端口', 0);
INSERT INTO `dp2_port_type` (`id`, `all_count`, `description`, `name`, `rest_count`) VALUES (8, 0, 'JMX监控', 'JMX', 0);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (1, 1, '', ' 服务管理端口', '', 'server_port', 2);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (2, 1, '', 'HTTP端口', '', 'http_port', 1);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (3, 1, '', 'HTTPS端口', '', 'https_port', 2);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (4, 1, '', 'AJP端口', '', 'ajp_port', 2);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (5, 1, '', 'JMX监控端口', '', 'jmx_port', 8);
INSERT INTO `dp2_app_var_define` (`id`, `app_type_id`, `default_value`, `form_label`, `input_addon`, `name`, `port_type_id`) VALUES (6, 2, '', 'JMX监控端口', '', 'jmx_port', 8);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (1, 'play.sh', '在目标主机安装运行环境：包括创建用户、安装配置JDK、Tomcat等运行环境', '安装', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (2, 'play.sh', '请求服务心跳API接口，将其设置为OFFLINE状态', '下线', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (3, 'play.sh', '请求服务心跳API接口，将其设置为ONLINE状态', '上线', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (4, 'play.sh', '访问心跳API接口，测试服务在线状态', '状态', 0, 'STATUS', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (5, 'play.sh', '从部署SVN更新资源并重启服务，更新前会先将其设置为OFFLINE状态并停止服务', '发布', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (8, 'play.sh', '停止Tomcat服务进程', '停止', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (9, 'play.sh', '启动Tomcat服务', '启动', 0, 'COMMON', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (10, 'play.sh', '在目标主机安装运行环境：包括创建用户、安装配置JDK等运行环境', '安装', 0, 'COMMON', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (11, 'play.sh', '用PS命令测试Java进程是否正在运行', '状态', 0, 'STATUS', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (12, 'play.sh', '停止Java服务，并删除旧资源，从部署SVN获取新资源后，启动Java服务', '发布', 0, 'COMMON', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (13, 'play.sh', '停止Java进程', '停止', 0, 'COMMON', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (14, 'play.sh', '启动Java服务', '启动', 0, 'COMMON', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (15, 'play.sh', '在目标主机删除安装的文件，删除创建的用户，移除自启动设置等', '删除', 0, 'DELETE', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (16, 'play.sh', '在目标主机安装运行环境：创建用户、在/etc/init.d配置服务启动脚本', '安装', 0, 'COMMON', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (17, 'play.sh', '停止应用，并删除旧资源，从部署SVN获取新资源后，启动应用', '发布', 0, 'COMMON', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (18, 'play.sh', '用PS命令测试进程是否正在运行', '状态', 0, 'STATUS', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (19, 'play.sh', '启动服务', '启动', 0, 'COMMON', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (20, 'play.sh', '停止服务', '停止', 0, 'COMMON', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (21, 'play.sh', '在目标主机删除安装的文件，删除创建的用户，移除自启动设置等', '删除', 0, 'DELETE', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (22, 'play.sh', '删除应用全局资源，比如部署资源库', '删除应用', 0, 'DELETE_APP', 3);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (23, 'play.sh', '删除应用全局资源，比如部署资源库', '删除应用', 0, 'DELETE_APP', 1);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (24, 'play.sh', '在目标主机删除安装的文件，删除创建的用户，移除自启动设置等', '删除', 0, 'DELETE', 2);
INSERT INTO `dp2_app_operation` (`id`, `command`, `description`, `name`, `released`, `type`, `app_type_id`) VALUES (25, 'play.sh', '删除应用全局资源，比如部署资源库', '删除应用', 0, 'DELETE_APP', 2);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (1, '- hosts: deploy_target\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 添加用户组"tomcat"\n      group: name=tomcat\n      become: yes\n\n    - name: 添加应用运行用户"{{ apptag }}"\n      user: name={{apptag}} group=tomcat createhome=yes\n      become: yes\n\n    - name: 判断JDK目录是否已存在\n      stat: path=/opt/jdk1.8.0_66\n      register: jdkDir\n\n    - name: 下载JDK\n      subversion: repo=svn://10.79.186.29:8000/download/jdk/jdk-8u66-linux-x64.tar.gz dest=/opt/jdk-8u66-linux-x64.tar.gz force=yes export=yes username=deploy password=unicorn4Felink\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 解压JDK安装包\n      unarchive: src=/opt/jdk-8u66-linux-x64.tar.gz dest=/opt copy=no\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 修改JDK目录owner与group\n      file: path=/opt//opt/jdk1.8.0_66 owner=root group=root state=directory recurse=yes\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 判断Tomcat目录是否已存在\n      stat: path=/home/{{apptag}}/tomcat-8.0.30\n      register: tomcatDir\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 从SVN下载Tomcat8\n      subversion: repo=svn://10.79.186.29:8000/download/tomcat/tomcat8 dest=/home/{{apptag}}/tomcat-8.0.30 force=no export=yes username=deploy password=unicorn4Felink\n      notify: restart tomcat\n      become: yes\n      become_user: "{{apptag}}"\n      when: tomcatDir.stat.exists == false\n\n    - name: 为Tomcat目录创建软连接\n      file: src=/home/{{apptag}}/tomcat-8.0.30 path=/home/{{apptag}}/tomcat state=link\n      become: yes\n      become_user: "{{apptag}}"\n      when: tomcatDir.stat.exists == false\n\n    - name: 使用模版配置Tomcat服务器\n      template: src=server.xml dest=/home/{{apptag}}/tomcat/conf/\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置Tomcat环境变量\n      template: src=setenv.sh dest=/home/{{apptag}}/tomcat/bin/setenv.sh mode=0644 owner={{apptag}} group=tomcat\n      become: yes\n\n    - name: 配置 jmx 访问权限\n      template: src=jmx.access dest=/home/{{apptag}}/tomcat/bin/ mode=0400 owner={{apptag}} group=tomcat\n      become: yes\n\n    - name: 配置 jmx 账号密码\n      template: src=jmx.password dest=/home/{{apptag}}/tomcat/bin/ mode=0400 owner={{apptag}} group=tomcat\n      become: yes\n\n    - name: 安装系统服务\n      template: src=tomcat-initscript.sh dest=/etc/init.d/tomcat-{{apptag}} mode=0755\n      become: yes\n\n- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 确认SVN库是否已创建\n      stat: path=/data/javasvn/{{apptag}}\n      register: rep\n      become: true\n\n    - name: 初始化SVN库目录 \n      command: chdir=/data/javasvn svnadmin create {{apptag}}\n      when: rep.stat.exists == False\n      become: true\n\n    - name: 配置SVN库\n      copy: src=svnserve.conf dest=/data/javasvn/{{apptag}}/conf mode=644\n      become: true\n', 'operation.yml', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (2, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (3, '<?xml version=\'1.0\' encoding=\'utf-8\'?>\n<Server port="{{ server_port }}" shutdown="SHUTDOWN">\n  <Listener className="org.apache.catalina.startup.VersionLoggerListener" />\n  <Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="on" />\n  <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" />\n  <Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" />\n  <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" />\n  <Service name="Catalina">\n    <Connector port="{{ http_port }}" protocol="HTTP/1.1"\n               connectionTimeout="20000"\n               redirectPort="{{ https_port }}" />\n    <Connector port="{{ ajp_port }}" protocol="AJP/1.3" redirectPort="{{ https_port }}" />\n    <Engine name="Catalina" defaultHost="localhost">\n      <Host name="localhost"  appBase="webapps/{{apptag}}" unpackWARs="false" autoDeploy="false">\n        <Context path="" docBase=""  reloadable="true" caseSensitive="false" debug="0"></Context>\n      </Host>\n    </Engine>\n  </Service>\n</Server>\n', 'server.xml', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (4, '#!/bin/bash\n\nexport JAVA_HOME=/opt/jdk1.8.0_66\nexport PRODUCT_HOME=/home/{{apptag}}\n\nJAVA_OPTS="$JAVA_OPTS {{exec_opt}}"\nJAVA_OPTS="$JAVA_OPTS -XX:+UseG1GC -XX:+PrintClassHistogram -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintGCDetails"\nJAVA_OPTS="$JAVA_OPTS -Xloggc:$PRODUCT_HOME/tomcat/logs/gc.log"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=true -Dcom.sun.management.jmxremote.ssl=false"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port={{jmx_port}} -Dcom.sun.management.jmxremote.rmi.port={{jmx_port}} -Djava.rmi.server.hostname={{inventory_hostname}}"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.password.file=$PRODUCT_HOME/tomcat/bin/jmx.password -Dcom.sun.management.jmxremote.access.file=$PRODUCT_HOME/tomcat/bin/jmx.access"\nexport JAVA_OPTS\n\nexport LANG=en_US.UTF-8\n', 'setenv.sh', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (5, 'user   readonly\nadmin  readwrite \\\n              create javax.management.monitor.*,javax.management.timer.* \\\n              unregister\n', 'jmx.access', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (6, 'admin  unicornAdmin\nuser  unicorn', 'jmx.password', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (7, '#!/bin/bash\n#\n# chkconfig: 345 99 28\n# description: Starts/Stops Apache Tomcat\n#\n \nexport CATALINA_HOME=/home/{{apptag}}/tomcat  \nexport CATALINA_BASE=/home/{{apptag}}/tomcat\nexport TOMCAT_USER={{apptag}}\nexport LANG=en_US.UTF-8\n \n#TOMCAT_USAGE is the message if this script is called without any options\nTOMCAT_USAGE="Usage: $0 {\\e[00;32mstart\\e[00m|\\e[00;31mstop\\e[00m|\\e[00;32mstatus\\e[00m|\\e[00;31mrestart\\e[00m}"\n \n#SHUTDOWN_WAIT is wait time in seconds for java proccess to stop\nSHUTDOWN_WAIT=20\n \ntomcat_pid() {\n  echo `ps -fe | grep $CATALINA_BASE | grep -v grep | tr -s " "|cut -d" " -f2`\n}\n \nstart() {\n  pid=$(tomcat_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mTomcat is already running (pid: $pid)\\e[00m"\n  else\n    echo -e "\\e[00;32mStarting tomcat\\e[00m"\n    #ulimit -n 100000\n    #umask 007\n    su - $TOMCAT_USER -c $CATALINA_HOME/bin/startup.sh\n    status\n  fi\n  return 0\n}\n \nstatus(){\n  pid=$(tomcat_pid)\n  if [ -n "$pid" ]; then echo -e "\\e[00;32mTomcat is running with pid: $pid\\e[00m"\n  else echo -e "\\e[00;31mTomcat is not running\\e[00m"\n  fi\n}\n \nstop() {\n  pid=$(tomcat_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mStoping Tomcat\\e[00m"\n    su - $TOMCAT_USER -c $CATALINA_HOME/bin/shutdown.sh\n    sleep 3\n    # Notify the Java Runtime ShutdownHooks\n    kill $pid\n    sleep 2\n    let kwait=$SHUTDOWN_WAIT\n    count=0;\n    until [ `ps -p $pid | grep -c $pid` = \'0\' ] || [ $count -gt $kwait ]\n    do\n      echo -n -e "\\n\\e[00;31mwaiting for processes to exit\\e[00m";\n      sleep 1\n      let count=$count+1;\n    done\n    if [ $count -gt $kwait ]; then\n      echo -n -e "\\n\\e[00;31mkilling processes which didn\'t stop after $SHUTDOWN_WAIT seconds\\e[00m"\n      kill -9 $pid\n    fi\n  else\n    echo -e "\\e[00;31mTomcat is not running\\e[00m"\n  fi\n \n  return 0\n}\n \ncase "$1" in\nstart)   start;;\nstop)    stop;;\nrestart) stop\n    start\n    ;;\nstatus)  status;;\n*)  echo -e $TOMCAT_USAGE;;\nesac\nexit 0\n', 'tomcat-initscript.sh', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (8, '[general]\nanon-access = none\nauth-access = write\npassword-db = ../../passwd\nauthz-db = ../../authz', 'svnserve.conf', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (10, '[svnhost]\n10.79.186.29\n\n', 'hosts', 1);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (11, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n\n    - name: 测试服务是否运行\n      shell: ps ax | grep /home/{{apptag}}/tomcat | grep java | grep -v grep | awk \'{print $1}\'\n      become: yes\n      register: running\n\n    - name: 将服务置为离线状态\n      uri:\n        url: http://localhost:{{http_port}}/heartbeat\n        method: PUT\n        body: "OFFLINE;c701e78243404508a08f021a4ac8966d"\n      when: running.stdout!=\'\'\n\n    - name: 确认服务已在离线状态\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: heartbeat\n      failed_when: "\'OFFLINE\' not in heartbeat.content"\n      when: running.stdout!=\'\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,状态,"\n      when: running.stdout!=\'\' and "\'OFFLINE\' in heartbeat.content"\n\n    - name: 延迟10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n      when: running.stdout!=\'\'\n\n    - name: 停止Tomcat服务\n      service: name=tomcat-{{apptag}} state=stopped\n      become: yes\n\n    - name: 确认服务端口已关闭\n      wait_for: \'port={{http_port}} state=stopped timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n\n    - name: 等待10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n      when: running.stdout!=\'\'\n\n    - name: 删除旧部署文件\n      file: path=/home/{{apptag}}/tomcat/webapps/{{apptag}} state=absent\n      become: yes\n\n    - name: 从资源库下载部署文件\n      subversion: repo=svn://10.79.186.29:8000/{{apptag}}/{{repository}} dest=/home/{{apptag}}/tomcat/webapps/{{apptag}} force=no username=deploy password=unicorn4Felink revision={{revision}}\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 启动Tomcat服务\n      service: name=tomcat-{{apptag}} state=started\n      become: yes\n\n    - name: 等待服务启动\n      wait_for: \'port={{http_port}} state=started timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,状态,"\n\n    - name: 等待10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n\n    - name: 状态测试\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: status\n\n    - name: 设置离线状态\n      debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,状态,"\n      when: "\'OFFLINE\' in status.content"\n\n    - name: 设置在线状态\n      debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},在线,online,状态,"\n      when: "\'ONLINE\' in status.content"\n', 'operation.yml', 5);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (12, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 5);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (13, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 将服务置为离线状态\n      uri:\n        url: http://localhost:{{http_port}}/heartbeat\n        method: PUT\n        body: "OFFLINE;c701e78243404508a08f021a4ac8966d"\n\n    - name: 确认服务已在离线状态\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: heartbeat\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,状态,"\n      when: "\'OFFLINE\' in heartbeat.content"\n', 'operation.yml', 2);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (14, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 2);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (15, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 将服务置为在线状态\n      uri:\n        url: http://localhost:{{http_port}}/heartbeat\n        method: PUT\n        body: "ONLINE;c701e78243404508a08f021a4ac8966d"\n\n    - name: 确认服务已在线\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: heartbeat\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},在线,online,状态,"\n      when: "\'ONLINE\' in heartbeat.content"', 'operation.yml', 3);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (16, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 3);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (17, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible-2.2.0\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport GROOVY_HOME=$HOME/groovy-2.4.10\nexport JAVA_HOME=/opt/jdk1.8.0_66\nexport JAVA_OPTS="-Dfile.encoding=utf-8"\nexport PATH=$PATH:$ANSIBLE_HOME/bin:$GROOVY_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 4);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (18, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n  - name: 获取进程PID\n    shell: ps ax | grep /home/{{apptag}}/tomcat | grep java | grep -v grep | awk \'{print $1}\'\n    become: yes\n    register: running\n\n  - name: 设置运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,"\n    when: running.stdout!=""\n\n  - name: 设置未运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,"\n    when: running.stdout==""\n\n  - name: 状态测试\n    uri: \n        url: http://localhost:{{http_port}}/heartbeat\n        return_content: true\n    become: yes\n    register: status\n    when: running.stdout!=""\n\n  - name: 设置离线状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,"\n    when: running.stdout!="" and "\'ONLINE\' in status.content"\n\n  - name: 设置在线状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},在线,online,"\n    when: running.stdout!="" and "\'ONLINE\' in status.content"', 'operation.yml', 4);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (22, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 8);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (23, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 测试服务是否运行\n      wait_for: \'port={{http_port}} state=started timeout=10\'\n      register: running\n\n    - name: 将服务置为离线状态\n      uri:\n        url: http://localhost:{{http_port}}/heartbeat\n        method: PUT\n        body: "OFFLINE;c701e78243404508a08f021a4ac8966d"\n      when: running.state==\'started\'\n\n    - name: 确认服务已在离线状态\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: heartbeat\n      failed_when: "\'OFFLINE\' not in heartbeat.content"\n      when: running.state==\'started\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,状态,"\n      when: "\'OFFLINE\' in heartbeat.content"\n\n    - name: 延迟10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n      when: running.state==\'started\'\n\n    - name: 停止Tomcat服务\n      service: name=tomcat-{{apptag}} state=stopped\n      become: yes\n\n    - name: 等待服务停止\n      wait_for: \'port={{http_port}} state=stopped timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n', 'operation.yml', 8);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (24, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 9);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (25, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 启动Tomcat服务\n      service: name=tomcat-{{apptag}} state=started\n      become: yes\n\n    - name: 等待服务启动\n      wait_for: \'port={{http_port}} state=started timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,状态,"\n\n    - name: 状态测试\n      uri: \n          url: http://localhost:{{http_port}}/heartbeat\n          return_content: true\n      become: yes\n      register: status\n\n    - name: 设置离线状态\n      debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},离线,offline,状态,"\n      when: "\'OFFLINE\' in status.content"\n\n    - name: 设置在线状态\n      debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},在线,online,状态,"\n      when: "\'ONLINE\' in status.content"', 'operation.yml', 9);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (26, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (27, '- hosts: deploy_target\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 添加应用运行用户"{{ apptag }}"\n      user: name={{apptag}} createhome=yes\n      become: yes\n      \n    - name: 判断JDK目录是否已存在\n      stat: path=/opt/jdk1.8.0_66\n      register: jdkDir\n\n    - name: 下载JDK\n      subversion: repo=svn://10.79.186.29:8000/download/jdk/jdk-8u66-linux-x64.tar.gz dest=/opt/jdk-8u66-linux-x64.tar.gz force=yes export=yes username=deploy password=unicorn4Felink\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 解压JDK安装包\n      unarchive: src=/opt/jdk-8u66-linux-x64.tar.gz dest=/opt copy=no\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 修改JDK目录owner与group\n      file: path=/opt//opt/jdk1.8.0_66 owner=root group=root state=directory recurse=yes\n      become: yes\n      when: jdkDir.stat.exists == false\n\n    - name: 创建bin目录\n      file: path=\'bin\' state=directory mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 创建logs目录\n      file: path=\'logs\' state=directory mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置获取PID脚本\n      template: src=showpid.sh dest=/home/{{apptag}}/bin/showpid.sh mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置启动进程脚本\n      template: src=startup.sh dest=/home/{{apptag}}/bin/startup.sh mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n      \n    - name: 配置停止进程脚本\n      template: src=shutdown.sh dest=/home/{{apptag}}/bin/shutdown.sh mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置 jmx 访问权限\n      template: src=jmx.access dest=/home/{{apptag}}/bin/ mode=0400\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置 jmx 账号密码\n      template: src=jmx.password dest=/home/{{apptag}}/bin/ mode=0400\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 配置Java环境变量\n      template: src=setenv.sh dest=/home/{{apptag}}/bin/setenv.sh mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 安装系统服务\n      template: src=java-initscript.sh dest=/etc/init.d/java-{{apptag}} mode=0755\n      become: yes\n\n    - name: 配置系统服务\n      service: name=java-{{apptag}} enabled=yes\n      become: yes\n\n- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 确认SVN库是否已创建\n      stat: path=/data/javasvn/{{apptag}}\n      register: rep\n      become: true\n\n    - name: 初始化SVN库目录\n      command: chdir=/data/javasvn svnadmin create {{apptag}}\n      when: rep.stat.exists == false\n      become: true\n\n    - name: 配置SVN库\n      copy: src=svnserve.conf dest=/data/javasvn/{{apptag}}/conf mode=644\n      become: true\n', 'operation.yml', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (28, '#!/bin/bash\n\nPRG="$0"\nPRGDIR=`dirname "$PRG"`\n\nif [ -r "$PRGDIR/setenv.sh" ]; then\n  . "$PRGDIR/setenv.sh"\nfi\n\nif [ -z "$APP_HOME" ]; then\n    echo ""\nelse\n    proc=`ps ax | grep $APP_HOME/{{apptag}} | grep java | grep -v grep | awk \'{print $1}\'`\n    echo $proc\nfi', 'showpid.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (29, '#!/bin/bash\n\nPRG="$0"\nPRGDIR=`dirname "$PRG"`\n\nif [ -r "$PRGDIR/setenv.sh" ]; then\n  . "$PRGDIR/setenv.sh"\nfi\n\nif [ -z "$APP_HOME" ]; then\n    echo "please export \\$APP_HOME at $PRGDIR/setenv.sh"\n    exit 1\nfi\n\nproc=`sh $PRGDIR/showpid.sh`\n\nif [ "$proc" = "" ]\nthen\n  echo "the Java app not alive"\nelse\n  echo "Shutting down current running Java app(pid=$proc) : $APP_HOME"\n  kill $proc\nfi', 'shutdown.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (30, '#!/bin/bash\n\nPRG="$0"\nPRGDIR=`dirname "$PRG"`\n\nif [ -r "$PRGDIR/setenv.sh" ]; then\n  . "$PRGDIR/setenv.sh"\nfi\n\nif [ -z "$APP_HOME" ]; then\n    echo "please export \\$APP_HOME at $PRGDIR/setenv.sh"\n    exit 1\nfi\n\nproc=`sh $PRGDIR/showpid.sh`\nif [ "$proc" = "" ]\nthen\n    cd $APP_HOME\n    APP_OUT="$APP_HOME"/logs/server.out\n    touch $APP_OUT\n\n    jar_file(){\n        echo `ls -t $APP_HOME/{{apptag}}/*.jar 2>/dev/null | head -1`\n    }\n    JAR_FILE=$(jar_file)\n\n    if [ -z $JAR_FILE ]; then\n        echo \'No jar file in APP_HOME: $APP_HOME\' >> "$APP_OUT"\n    else\n        echo "Using APP_HOME:   $APP_HOME" >> "$APP_OUT"\n        echo "Using JAVA_HOME:  $JAVA_HOME" >> "$APP_OUT"\n        echo "Using JAR_FILE:   $JAR_FILE" >> "$APP_OUT"\n        JAVA="$JAVA_HOME/bin/java"\n        nohup $JAVA $JAVA_OPTS -jar $JAR_FILE "$@" >> "$APP_OUT" 2>&1 &\n        msg="Java process started at $APP_HOME,(pid=$!)"\n        echo $msg\n    fi\nelse\n  msg="skipped start action, the Java app already running"\n  echo $msg\nfi\n', 'startup.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (31, 'user   readonly\nadmin  readwrite \\\n              create javax.management.monitor.*,javax.management.timer.* \\\n              unregister\n', 'jmx.access', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (32, 'admin  unicornAdmin\nuser  unicorn', 'jmx.password', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (33, '#!/bin/bash\n\nexport JAVA_HOME=/opt/jdk1.8.0_66\nexport LANG=en_US.UTF-8\nexport PRODUCT_HOME=/home/{{apptag}}\nexport APP_HOME=/home/{{apptag}}\n\nJAVA_OPTS="$JAVA_OPTS -server {{exec_opt}}"\nJAVA_OPTS="$JAVA_OPTS -XX:+UseG1GC -XX:+PrintClassHistogram -XX:+PrintGCTimeStamps -XX:+PrintGCDateStamps -XX:+PrintGCDetails"\nJAVA_OPTS="$JAVA_OPTS -Xloggc:$APP_HOME/logs/gc.log"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=true -Dcom.sun.management.jmxremote.ssl=false"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.port={{jmx_port}} -Dcom.sun.management.jmxremote.rmi.port={{jmx_port}} -Djava.rmi.server.hostname={{inventory_hostname}}"\nJAVA_OPTS="$JAVA_OPTS -Dcom.sun.management.jmxremote.password.file=$PRODUCT_HOME/bin/jmx.password -Dcom.sun.management.jmxremote.access.file=$PRODUCT_HOME/bin/jmx.access"\nexport JAVA_OPTS\n', 'setenv.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (34, '#!/bin/bash\n#\n# chkconfig: 345 99 28\n# description: Starts/Stops Java App\n#\nexport APP_HOME=/home/{{apptag}} \nexport APP_BASE=/home/{{apptag}}\nexport APP_USER={{apptag}}\nexport LANG=en_US.UTF-8\n \n#APP_USAGE is the message if this script is called without any options\nAPP_USAGE="Usage: $0 {\\e[00;32mstart\\e[00m|\\e[00;31mstop\\e[00m|\\e[00;32mstatus\\e[00m|\\e[00;31mrestart\\e[00m}"\nAPP_NAME={{apptag}}\n \n#SHUTDOWN_WAIT is wait time in seconds for java proccess to stop\nSHUTDOWN_WAIT=20\n \napp_pid() {\n  echo `ps -fe | grep $APP_BASE/{{apptag}} | grep java | grep -v grep | tr -s " "|cut -d" " -f2`\n}\n \nstart() {\n  pid=$(app_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mJava app is already running (pid: $pid)\\e[00m"\n  else\n    echo -e "\\e[00;32mStarting java app\\e[00m"\n    #ulimit -n 100000\n    #umask 007\n    touch /var/lock/subsys/$APP_NAME\n    su - $APP_USER -c $APP_BASE/bin/startup.sh\n    status\n  fi\n  return 0\n}\n \nstatus(){\n  pid=$(app_pid)\n  if [ -n "$pid" ]; then echo -e "\\e[00;32mJava app is running with pid: $pid\\e[00m"\n  else echo -e "\\e[00;31mJava app is not running\\e[00m"\n  fi\n}\n \nstop() {\n  pid=$(app_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mStoping Java app\\e[00m"\n    rm -f /var/lock/subsys/$APP_NAME\n    su - $APP_USER -c $APP_BASE/bin/shutdown.sh\n    let kwait=$SHUTDOWN_WAIT\n    count=0;\n    until [ `ps -p $pid | grep -c $pid` = \'0\' ] || [ $count -gt $kwait ]\n    do\n      echo -n -e "\\n\\e[00;31mwaiting for processes to exit\\e[00m";\n      sleep 1\n      let count=$count+1;\n    done\n    if [ $count -gt $kwait ]; then\n      echo -n -e "\\n\\e[00;31mkilling processes which didn\'t stop after $SHUTDOWN_WAIT seconds\\e[00m"\n      kill -9 $pid\n    fi\n  else\n    echo -e "\\e[00;31mJava app is not running\\e[00m"\n  fi\n \n  return 0\n}\n \ncase "$1" in\nstart)   start;;\nstop)    stop;;\nrestart) stop\n    start\n    ;;\nstatus)  status;;\n*)  echo -e $APP_USAGE;;\nesac\nexit 0\n', 'java-initscript.sh', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (36, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible-2.2.0\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport GROOVY_HOME=$HOME/groovy-2.4.10\nexport JAVA_HOME=/opt/jdk1.8.0_66\nexport JAVA_OPTS="-Dfile.encoding=utf-8"\nexport PATH=$PATH:$ANSIBLE_HOME/bin:$GROOVY_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 11);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (37, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n  - name: 获取进程PID\n    shell: ps ax | grep /home/{{apptag}}/{{apptag}} | grep java | grep -v grep | awk \'{print $1}\'\n    become: yes\n    register: running\n\n  - name: 设置运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,"\n    when: running.stdout!=""\n\n  - name: 设置未运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,"\n    when: running.stdout==""', 'operation.yml', 11);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (38, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 获取进程PID\n      shell: ps ax | grep /home/{{apptag}}/{{apptag}} | grep java | grep -v grep | awk \'{print $1}\'\n      become: yes\n      register: running\n\n    - name: 停止服务\n      service: name=java-{{apptag}} state=stopped\n      become: yes\n\n    - name: 等待JMX端口关闭\n      wait_for: \'port={{jmx_port}} state=stopped timeout=10\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n\n    - name: 延迟10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n      when: running.stdout!=\'\'\n\n    - name: 删除旧部署文件\n      file: path=/home/{{apptag}}/{{apptag}} state=absent\n      become: yes\n\n    - name: 从资源库下载部署文件\n      subversion: repo=svn://10.79.186.29:8000/{{apptag}}/{{repository}} dest=/home/{{apptag}}/{{apptag}} force=no username=deploy password=unicorn4Felink revision={{revision}}\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 启动服务\n      service: name=java-{{apptag}} state=started\n      become: yes\n\n    - name: 等待服务启动\n      wait_for: \'port={{jmx_port}} state=started timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,状态,"\n', 'operation.yml', 12);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (39, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 12);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (40, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 13);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (41, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 停止服务\n      service: name=java-{{apptag}} state=stopped\n      become: yes\n\n    - name: 等待服务停止\n      wait_for: \'port={{jmx_port}} state=stopped timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n', 'operation.yml', 13);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (42, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 启动Java服务\n      service: name=java-{{apptag}} state=started\n      become: yes\n\n    - name: 等待服务启动\n      wait_for: \'port={{jmx_port}} state=started timeout=30\'\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,状态,"\n', 'operation.yml', 14);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (43, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 14);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (44, '[svnhost]\n10.79.186.29', 'hosts', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (45, '[general]\nanon-access = none\nauth-access = write\npassword-db = ../../passwd\nauthz-db = ../../authz', 'svnserve.conf', 10);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (46, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 测试服务是否运行\n      wait_for: \'port={{http_port}} state=started timeout=5\'\n      register: running\n      ignore_errors: true\n\n    - name: 将服务置为离线状态\n      shell: curl -X PUT -d "OFFLINE;c701e78243404508a08f021a4ac8966d" http://localhost:{{http_port}}/heartbeat\n      become: yes\n      ignore_errors: true\n      when: not running.failed\n\n    - name: 延迟10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n      when: not running.failed\n\n    - name: 停止Tomcat服务\n      service: name=tomcat-{{apptag}} state=stopped\n      become: yes\n      ignore_errors: true\n\n    - name: 测试服务是否运行\n      wait_for: \'port={{http_port}} state=stopped timeout=5\'\n\n    - name: 延迟5秒\n      wait_for: \'timeout=5\'\n      delegate_to: localhost\n      when: not running.failed\n\n    - name: 删除随机启动文件\n      file: path=/etc/init.d/tomcat-{{apptag}} state=absent\n      become: yes\n\n    - name: 删除用户 "{{ apptag}}"及其Home目录\n      user: name={{apptag}} state=absent remove=yes\n      become: yes\n', 'operation.yml', 15);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (47, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 15);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (48, '- hosts: deploy_target\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 添加应用运行用户"{{ apptag }}"\n      user: name={{apptag}} createhome=yes\n      become: yes\n\n    - name: 创建logs目录\n      file: path=\'logs\' state=directory mode=0755\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: 安装系统服务\n      template: src=command-initscript.sh dest=/etc/init.d/command-{{apptag}} mode=0755\n      become: yes\n\n    - name: 配置系统服务\n      service: name=command-{{apptag}} enabled=yes\n      become: yes\n\n- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 确认SVN库是否已创建\n      stat: path=/data/javasvn/{{apptag}}\n      register: rep\n      become: true\n\n    - name: 初始化SVN库目录\n      command: chdir=/data/javasvn svnadmin create {{apptag}}\n      when: rep.stat.exists == false\n      become: true\n\n    - name: 配置SVN库\n      copy: src=svnserve.conf dest=/data/javasvn/{{apptag}}/conf mode=644\n      become: true\n', 'operation.yml', 16);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (49, '#!/bin/bash\n#\n# chkconfig: 345 99 28\n# description: Starts/Stops Command App\n#\n \nexport APP_HOME=/home/{{apptag}}/{{apptag}}\nexport APP_BASE=/home/{{apptag}}\nexport APP_USER={{apptag}}\nexport LANG=en_US.UTF-8\n \n#APP_USAGE is the message if this script is called without any options\nAPP_USAGE="Usage: $0 {\\e[00;32mstart\\e[00m|\\e[00;31mstop\\e[00m|\\e[00;32mstatus\\e[00m|\\e[00;31mrestart\\e[00m}"\nAPP_NAME={{apptag}}\n \n#SHUTDOWN_WAIT is wait time in seconds for command proccess to stop\nSHUTDOWN_WAIT=20\n \napp_pid() {\n  echo `ps ax | grep /home/{{apptag}}/{{apptag}} | grep -v grep | awk \'{print $1}\'`\n}\n \nstart() {\n  pid=$(app_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mcommand app is already running (pid: $pid)\\e[00m"\n  else\n    echo -e "\\e[00;32mStarting command app\\e[00m"\n    touch /var/lock/subsys/$APP_NAME\n    su - $APP_USER -c $APP_HOME/startup.sh\n    status\n  fi\n  return 0\n}\n \nstatus(){\n  pid=$(app_pid)\n  if [ -n "$pid" ]; then echo -e "\\e[00;32mCommand app is running with pid: $pid\\e[00m"\n  else echo -e "\\e[00;31mCommand app is not running\\e[00m"\n  fi\n}\n \nstop() {\n  pid=$(app_pid)\n  if [ -n "$pid" ]\n  then\n    echo -e "\\e[00;31mStoping Command app: $pid\\e[00m"\n    rm -f /var/lock/subsys/$APP_NAME\n    su - $APP_USER -c $APP_HOME/shutdown.sh\n    let kwait=$SHUTDOWN_WAIT\n    count=0;\n    until [ `ps -p $pid | grep -c $pid` = \'0\' ] || [ $count -gt $kwait ]\n    do\n      echo -n -e "\\n\\e[00;31mwaiting for processes to exit\\e[00m";\n      sleep 1\n      let count=$count+1;\n    done\n    if [ $count -gt $kwait ]; then\n      echo -n -e "\\n\\e[00;31mkilling processes which didn\'t stop after $SHUTDOWN_WAIT seconds\\e[00m"\n      kill -9 $pid\n    fi\n  else\n    echo -e "\\e[00;31mCommand app is not running\\e[00m"\n  fi\n \n  return 0\n}\n \ncase "$1" in\nstart)   start;;\nstop)    stop;;\nrestart) stop\n    start\n    ;;\nstatus)  status;;\n*)  echo -e $APP_USAGE;;\nesac\nexit 0\n', 'command-initscript.sh', 16);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (50, '[svnhost]\n10.79.186.29', 'hosts', 16);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (51, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 17);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (52, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 停止服务\n      service: name=command-{{apptag}} state=stopped\n      become: yes\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n\n    - name: 延迟10秒\n      wait_for: \'timeout=10\'\n      delegate_to: localhost\n\n    - name: 删除旧部署文件\n      file: path=/home/{{apptag}}/{{apptag}} state=absent\n      become: yes\n\n    - name: 从资源库下载部署文件\n      subversion: repo=svn://10.79.186.29:8000/{{apptag}}/{{repository}} dest=/home/{{apptag}}/{{apptag}} force=no username=deploy password=unicorn4Felink revision={{revision}}\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: chmod startup.sh 554\n      file: state=file path=/home/{{apptag}}/{{apptag}}/startup.sh mode=554\n      become: yes\n      become_user: "{{apptag}}"\n\n    - name: chmod shutdown.sh 554\n      file: state=file path=/home/{{apptag}}/{{apptag}}/shutdown.sh mode=554\n      become: yes\n      become_user: "{{apptag}}"', 'operation.yml', 17);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (53, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n  - name: 获取进程PID\n    shell: ps ax | grep /home/{{apptag}}/{{apptag}} | grep -v grep | awk \'{print $1}\'\n    become: yes\n    register: running\n\n  - name: 设置运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,"\n    when: running.stdout!=""\n\n  - name: 设置未运行状态\n    debug:\n      msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,"\n    when: running.stdout==""', 'operation.yml', 18);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (54, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible-2.2.0\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport GROOVY_HOME=$HOME/groovy-2.4.10\nexport JAVA_HOME=/opt/jdk1.8.0_66\nexport JAVA_OPTS="-Dfile.encoding=utf-8"\nexport PATH=$PATH:$ANSIBLE_HOME/bin:$GROOVY_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 18);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (55, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 启动服务\n      service: name=command-{{apptag}} state=started\n      become: yes\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},运行中,running,状态,"\n', 'operation.yml', 19);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (56, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 19);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (57, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 20);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (58, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 停止服务\n      service: name=command-{{apptag}} state=stopped\n      become: yes\n\n    - debug:\n        msg: "@@SET_HOST_STATUS {{inventory_hostname}},已停止,stopped,状态,"\n', 'operation.yml', 20);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (59, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 16);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (60, '[general]\nanon-access = none\nauth-access = write\npassword-db = ../../passwd\nauthz-db = ../../authz', 'svnserve.conf', 16);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (61, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 21);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (62, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 停止服务\n      service: name=command-{{apptag}} state=stopped\n      become: yes\n      ignore_errors: yes\n\n    - name: 延迟5秒\n      wait_for: \'timeout=5\'\n      delegate_to: localhost\n\n    - name: 删除随机启动文件\n      file: path=/etc/init.d/command-{{apptag}} state=absent\n      become: yes\n\n    - name: 删除用户 "{{ apptag}}"及其Home目录\n      user: name={{apptag}} state=absent remove=yes\n      become: yes\n', 'operation.yml', 21);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (63, '[svnhost]\n10.79.186.29', 'hosts', 22);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (64, '- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 删除SVN库目录 \n      file: path=/data/javasvn/{{apptag}} state=absent \n      become: yes', 'operation.yml', 22);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (65, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 22);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (66, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 23);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (67, '- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 删除SVN库目录 \n      file: path=/data/javasvn/{{apptag}} state=absent \n      become: yes', 'operation.yml', 23);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (68, '[svnhost]\n10.79.186.29', 'hosts', 23);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (69, '- hosts: deploy_target \n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 停止服务\n      service: name=java-{{apptag}} state=stopped\n      become: yes\n      ignore_errors: yes\n\n    - name: 延迟5秒\n      wait_for: \'timeout=5\'\n      delegate_to: localhost\n\n    - name: 等待JMX端口关闭\n      wait_for: \'port={{jmx_port}} state=stopped timeout=10\'\n\n    - name: 删除随机启动文件\n      file: path=/etc/init.d/java-{{apptag}} state=absent\n      become: yes\n\n    - name: 删除用户 "{{ apptag}}"及其Home目录\n      user: name={{apptag}} state=absent remove=yes\n      become: yes\n', 'operation.yml', 24);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (70, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 24);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (71, '[svnhost]\n10.79.186.29', 'hosts', 25);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (72, '#!/bin/bash\ncd $(dirname $0)\nexport ANSIBLE_HOME=$HOME/ansible\nexport MANPATH=$MANPATH:$ANSIBLE_HOME/docs/man\nexport PYTHONPATH=$PYTHONPATH:$ANSIBLE_HOME/lib\nexport PATH=$PATH:$ANSIBLE_HOME/bin\nexport LANG=en_US.UTF-8\nansible-playbook -i hosts operation.yml', 'play.sh', 25);
INSERT INTO `dp2_app_operation_code` (`id`, `code`, `file_name`, `operation_id`) VALUES (73, '- hosts: svnhost\n  remote_user: op\n  vars_files:\n    - vars.yml\n  tasks:\n    - name: 删除SVN库目录 \n      file: path=/data/javasvn/{{apptag}} state=absent \n      become: yes', 'operation.yml', 25);
