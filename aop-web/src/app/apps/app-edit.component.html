<div id="groups-contain" class="container-xl mt-3">
    <div id="group-head" class="mb-5">
        <h1>应用配置</h1>
        <div>请在这里配置你的应用，注意不要与目标机器上已部署应用冲突</div>
    </div>
    <ng-template #formInfoIcon>
        <svg width="18" height="18" viewBox="0 0 18 18" class="bi bi-question-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
            <path d="M5.25 6.033h1.32c0-.781.458-1.384 1.36-1.384.685 0 1.313.343 1.313 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.007.463h1.307v-.355c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.326 0-2.786.647-2.754 2.533zm1.562 5.516c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
        </svg>
    </ng-template>
    <form (submit)="save($event)" [formGroup]="appForm | async">
        <div class="row form-group">
            <div class="col-lg-6 col-md-6 form-group mb-4">
                <label for="apptag">应用短名
                    <ng-template #apptagPopContent>这是一个很基础的参数，系统会用这个名字创建Linux用户、SVN仓库、创建Haproxy节点名等</ng-template>
                    <span class="mx-1" [ngbPopover]="apptagPopContent">
                        <ng-container *ngTemplateOutlet="formInfoIcon"></ng-container>
                    </span>
                    <span class="text-danger" *ngIf="(apptag|async)?.errors?.required">*</span>
                    <span class="text-danger" *ngIf="(apptag|async)?.errors?.minlength || (apptag|async)?.errors?.maxlength">(长度4至30)</span>
                </label>
                <input type="text" id="apptag" formControlName="apptag" class="form-control" placeholder="以字母开头，由字母与下划线组成">
            </div>
            <div class="col-lg-6 col-md-6 form-group mb-4">
                <label for="deployPath">应用发布目标路径
                    <ng-template #deployPathPopContent>发布时系统自动将文件更新到这个目录下，如果你到服务器上手工修改了其中的文件，请记得提交，或在发布前revert回原来的版本，SVN在检测到目标目录中有改动将会停止操作，以防止与SVN库中的版本发生意外的合并或冲突</ng-template>
                    <span class="mx-1" [ngbPopover]="deployPathPopContent">
                        <ng-container *ngTemplateOutlet="formInfoIcon"></ng-container>
                    </span>
                    <span class="text-danger" *ngIf="(deployPath|async)?.invalid">(长度4至128)</span>
                </label>
                <div class="input-group">
                    <div class="input-group-prepend">
                        <span class="input-group-text">{{deployPathAddon | async}}</span>
                    </div>
                    <input type="text" id="deployPath" formControlName="deployPath" class="form-control" placeholder="建议设置为应用短名">
                </div>
            </div>
            <div *ngFor="let v of (app|async)?.vars" class="col-lg-6 col-md-6 form-group mb-4">
                <label for="var_{{v.name}}">{{v.description}}
                    <span class="text-danger" *ngIf="(appForm | async).get('var_'+v.name)?.invalid">(长度0至128)</span>
                </label>
                <div class="input-group">
                    <div class="input-group-prepend"  *ngIf="v.inputAddon.length > 0">
                        <span class="input-group-text">{{v.inputAddon}}</span>
                    </div>
                    <input [type]="v.inputType" id="var_{{v.name}}" formControlName="var_{{v.name}}" class="form-control" [placeholder]="v.isPort?'保存时自动分配':''">
                </div>
            </div>
            <div class="col-lg-6 col-md-6 form-group mb-4">
                <label for="inputJmx">JMX 监控</label>
                <div class="pt-2" id="inputJmx">
                    <label for="enableJmx" class="form-check-label">允许系统监控应用</label>
                    <input type="checkbox" id="enableJmx" formControlName="enableJmx" class="form-check-input ml-2"/>
                </div>
            </div>
        </div>

        <div class="row form-group mb-4">
            <div class="col-lg-12 col-md-12 form-group">
                <label for="description">应用描述
                    <span class="text-danger" *ngIf="(description|async)?.errors?.required">*</span>
                    <span class="text-danger" *ngIf="(description|async)?.errors?.minlength || (description|async)?.errors?.maxlength">(长度5至256)</span>
                </label>
                <textarea id="description" class="form-control" rows="3" formControlName="description"></textarea>
            </div>
        </div>

        <div class="row form-group">
            <div class="col-lg-12 col-md-12 form-group text-right">
                <button type="button" class="btn btn-outline-secondary mr-3" (click)="cancel()">取消</button>
                <button type="submit" class="btn btn-danger" [disabled]="(appForm|async).invalid || (appForm|async).pristine">保存</button>
            </div>
        </div>

        <!-- 
        <div class="row form-group" ng-show="app.apptype=='tomcat'">
            <div class="col-lg-12 col-md-12 form-group">
                <label class="control-label">自定义server.xml配置</label>
                <div class="choose-file-area">
                    <input type="file" nv-file-select="" uploader="uploader" />
                    <div class="alert alert-info"
                        ng-show="app.tomcatConfigeFile.id!=null && app.tomcatConfigeFile.id!=-1">
                        已经上传了server.xml文件,再次上传将覆盖原有的server.xml文件
                    </div>
                </div>
                <table class="table">
                    <thead>
                        <tr>
                            <th width="50%">Name</th>
                            <th ng-show="uploader.isHTML5">Size</th>
                            <th ng-show="uploader.isHTML5">Progress</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in uploader.queue">
                            <td><strong>{{ item.file.name }}</strong></td>
                            <td ng-show="uploader.isHTML5" nowrap>{{ item.file.size/1024/1024|number:4 }} MB</td>
                            <td ng-show="uploader.isHTML5">
                                <div class="progress" style="margin-bottom: 0;">
                                    <div class="progress-bar" role="progressbar"
                                        ng-style="{ 'width': item.progress + '%' }"></div>
                                </div>
                            </td>
                            <td class="text-center">
                                <span ng-show="item.isSuccess"><i class="glyphicon glyphicon-ok"></i></span>
                                <span ng-show="item.isCancel"><i class="glyphicon glyphicon-ban-circle"></i></span>
                                <span ng-show="item.isError"><i class="glyphicon glyphicon-remove"></i></span>
                            </td>
                            <td nowrap>
                                <button type="button" class="btn btn-success btn-xs" ng-click="item.upload()"
                                    ng-disabled="item.isReady || item.isUploading || item.isSuccess">
                                    <span class="glyphicon glyphicon-upload"></span> Upload
                                </button>
                                <button type="button" class="btn btn-danger btn-xs" ng-click="item.remove()">
                                    <span class="glyphicon glyphicon-trash"></span> Remove
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>




        <div class="row form-group">
            <div class="col-lg-12 col-md-12 form-group">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">请添加项目版本<button type="button" class="btn btn-success btn-xs"
                                ng-click="addVersion(app)">增加</button></h3>
                    </div>

                    <table class="table" ng-repeat="version in app.versions" border="1">
                        <tbody>
                            <tr>
                                <td>
                                    <div class="col-lg-12 col-md-12 form-group">
                                        <label class="control-label">项目版本
                                            <button type="button" class="btn btn-success btn-xs"
                                                ng-click="selectHost(version)">选择部署主机</button>
                                            <button type="button" class="btn btn-success btn-xs"
                                                ng-click="delVersion(version)">删除</button>
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-addon">项目版本名称 </span>
                                            <input type="text" name="{{version.name}}" class="form-control"
                                                ng-minlength="1" ng-maxlength="128" ng-model="version.name" />
                                        </div>
                                    </div>

                                    <div class="col-lg-6 col-md-6 form-group">
                                        <label class="control-label">应用SVN地址
                                            <span class="text-danger"
                                                ng-show="t.selected && appForm.inputRepoPath.$invalid">(长度1至128)</span>
                                            <span class="glyphicon glyphicon glyphicon-info-sign" aria-hidden="true"
                                                data-toggle="popover" title="说明"
                                                data-content="发布时系统自动从这个地址更新文件，如果你修改了分支，在update前将会先进行switch的操作"></span>
                                        </label>
                                        <div class="input-group">
                                            <span class="input-group-addon">svn://{{svnaddr}}/{{app.apptag}}/</span>
                                            <input type="text" name="{{app.versions.length}}_inputRepoPath"
                                                class="form-control" ng-minlength="1" ng-maxlength="128"
                                                ng-model="version.repository">
                                        </div>
                                    </div>
                                    <div class="col-lg-6 col-md-6 form-group">
                                        <label class="control-label">应用SVN-Revision<span class="text-danger"
                                                ng-show="t.selected && appForm.inputRevision.$invalid">(长度1至64)</span></label>
                                        <span class="glyphicon glyphicon glyphicon-info-sign" aria-hidden="true"
                                            data-toggle="popover" title="说明"
                                            data-content="不要修改这个值，除非你要明确的指定一个revision或者tag版本进行发布"></span>
                                        <input type="text" id="{{app.versions.length}}_inputRevision"
                                            name={{app.versions.length}}_inputRevision" class="form-control"
                                            ng-minlength="1" ng-maxlength="64" ng-model="version.revision" />
                                    </div>

                                    <div class="col-lg-6 col-md-6 form-group" ng-show="'command'!= app.apptype">
                                        <label class="control-label">JVM附加参数<span class="text-danger"
                                                ng-show="t.selected && appForm.JAVA_OPTS.$invalid">(长度1至256)</span></label>
                                        <input type="text" name="{{app.versions.length}}_JAVA_OPTS" ng-minlength="1"
                                            ng-maxlength="256" class="form-control" ng-model="version.javaOpt" />
                                    </div>
                                </td>
                            </tr>

                            <tr ng-show="version.versionTargetHosts !=null">
                                <td>
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>内网IP</th>
                                                <th>公网IP</th>
                                                <th>描述</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr ng-repeat="t in version.versionTargetHosts">
                                                <td>{{t.host.privateIp}}</td>
                                                <td>{{t.host.publicIp}}</td>
                                                <td>{{t.host.describes}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="row form-group">
            <div class="col-lg-12 col-md-12 form-group text-right">
                <button type="button" class="btn btn-default" ng-click="save(app)"
                    ng-disabled="(appForm.$invalid || appForm.$pristine) && isModify">保存</button>
                <button type="button" class="btn btn-default" ng-click="cancel()">取消</button>
            </div>
        </div> -->
    </form>
</div>